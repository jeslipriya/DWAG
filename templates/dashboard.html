{% extends "base.html" %}
{% block title %}Dashboard{% endblock %}

{% block content %}
<div class="dashboard-header">
    <h1>Welcome, {{ user.username }}!</h1>
    <p>Track your productivity across all dimensions of your life.</p>
</div>

<div class="dashboard-stats">
    <div class="stat-card">
        <h3>Total Tasks</h3>
        <p>{{ user.tasks|length }}</p>
    </div>
    <div class="stat-card">
        <h3>Completed</h3>
        <p>{{ user.tasks|selectattr('completed')|list|length }}</p>
    </div>
    <div class="stat-card">
        <h3>Completion Rate</h3>
        <p>
            {% if user.tasks|length > 0 %}
                {{ (user.tasks|selectattr('completed')|list|length / user.tasks|length * 100)|round(1) }}%
            {% else %}
                0%
            {% endif %}
        </p>
    </div>
</div>

<div class="dashboard-actions">
    <a href="{{ url_for('add_task') }}" class="btn btn-primary">Add New Task</a>
    <a href="{{ url_for('view_tasks') }}" class="btn btn-secondary">View All Tasks</a>
    <a href="{{ url_for('graph') }}" class="btn btn-tertiary">View Graph</a>
</div>

<div class="recent-tasks">
    <h2>Recent Tasks</h2>
    {% if user.tasks[-3:] %}
        {% for task in user.tasks[-3:]|reverse %}
            <div class="task-card {% if task.completed %}completed{% endif %}">
                <div class="task-title">
                    <span>{{ task.title }}</span>
                    <span class="task-category category-{{ task.category.lower() }}">{{ task.category }}</span>
                </div>
                <p class="task-description">{{ task.description }}</p>
                <div class="task-footer">
                    <span>{{ task.date_created.strftime('%b %d, %Y') }}</span>
                    {% if not task.completed %}
                        <a href="{{ url_for('complete_task', task_id=task.id) }}" class="btn btn-small">Mark Complete</a>
                    {% else %}
                        <span>Completed</span>
                    {% endif %}
                </div>
            </div>
        {% endfor %}
    {% else %}
        <p>No tasks yet. <a href="{{ url_for('add_task') }}">Add your first task</a> to get started!</p>
    {% endif %}
</div>
{% endblock %}
